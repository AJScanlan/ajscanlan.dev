---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getEntry } from "astro:content";
import Callout from "@/components/Callout.astro";

export async function getStaticPaths() {
    const { getCollection } = await import("astro:content");
    const posts = await getCollection(
        "thoughts",
        ({ data }) => data.status === "published",
    );
    return posts.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntry("thoughts", slug);
if (!entry) throw new Error(`Post not found: ${slug}`);
const { Content } = await entry.render();
const { data } = entry;
---

<BaseLayout
    title={`${data.title} - ajscanlan.dev`}
    description={data.dek}
>
    <article class="prose dark:prose-invert prose-text max-w-prose">
        <header class="mb-rhythm-8">
            <h1 class="mb-rhythm-2">{data.title}</h1>
            <p class="text-ink-600 dark:text-ink-400 text-sm">
                <time
                    >{
                        new Date(data.date).toLocaleDateString("en-IE", {
                            year: "numeric",
                            month: "short",
                            day: "2-digit",
                        })
                    }</time
                >
                {
                    data.updated && (
                        <span>
                            {" "}
                            Â· updated{" "}
                            {new Date(data.updated).toLocaleDateString("en-IE")}
                        </span>
                    )
                }
            </p>
        </header>
        <Content components={{ Callout }} />
    </article>
</BaseLayout>
